---
title: "Creando informes en PDF"
author: "Crispthofer Rincon"
date: "`r Sys.Date()`"
output: pdf_document
  # pdf_document: 
  # keep_text: true 
  # toc: yes 
  # fig_width: 5 
  # fig_height: 5 
  # fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

En esta sesión de clase se usara como ejemplo el informe de la clase 6.


```{r}
# Getting data
library(gapminder)
library(ggplot2)
library(plotly)
data("gapminder")
```

# Gráficos 

```{r}
# {.tabset .tabset-pills}
```

## Gráfico de barras interactivo

Este gráfico muestra la esperanza de vida promedio en cada continente en el año 2007.

```{r}
EVP_grafico_barras <- gapminder %>%
  filter(year == 2007) %>%
  group_by(continent) %>%
  summarise( lifeExpMean = mean(lifeExp)) %>%
  ggplot(
    aes(x = continent, y = lifeExpMean, 
        text = paste(
          "Continente:", continent,
          "<br>Esperanza de vida:", round(lifeExpMean, 2)
          ))
    ) +
  geom_bar(
    stat = "identity", fill = "skyblue"
    ) +
  labs(
    title = "Esperanza de Vida Promedio por Continente (2007)", 
    x = "Continente", y = "Esperanza de Vida Promedio") +
  theme_minimal()

EVP_grafico_barras

# EVP_grafico_barras <- ggplotly(EVP_grafico_barras, tooltip = "text")
# 
#EVP_grafico_barras

```
- Interpretacion

## Gráfico de lineas

Este gráfico muestra la evolución del PIB percápita de Colombia de 1952 a 2007. Note que este gráfico no tiene que ser interactivo.

```{r}
PIBpercap_colombia_grafico_lineas <- gapminder %>%
  filter(country == "Colombia") %>%
  ggplot(
    aes(x = year, y = gdpPercap)
    ) +
  geom_line() +
  labs(
    title = "Evolución PIB percápita de Colombia 1952 - 2007", 
    x = "Año", y = "PIB percápita ($US)") +
  theme_minimal()


PIBpercap_colombia_grafico_lineas
```

## Gráfico de dispersión interactivo

Este gráfico muestra el PIB percápita y la expectativa de vida al nacer por país en el año 2007.

```{r}

PIBpercap_lifeExp_grafico_puntos <- gapminder %>%
  filter(year == 2007) %>%
  ggplot(
    aes(
      x = gdpPercap, y = lifeExp,
      text = paste(
          "Año:", year,
          "<br>Esperanza de vida:",
          round(lifeExp, 2)
          )
      )
    ) +
  geom_point() +
  labs(
    title = "PIB percápita vs Expectativa de vida en el año 2007", 
    x = "PIB percápita", y = "Esperanza de vida (años)") +
  theme_minimal()

PIBpercap_lifeExp_grafico_puntos

# PIBpercap_lifeExp_grafico_puntos <- ggplotly(PIBpercap_lifeExp_grafico_puntos, tooltip = "text")
# 
# PIBpercap_lifeExp_grafico_puntos

```


## Gráfico Boxplot

Boxplot de la esperanza de vida al nacer por continente para 2007.

```{r}

lifeExp_2007_grafico_boxplot <- gapminder %>%
  filter(year == 2007) %>%
  group_by(continent) %>%
  ggplot(
    aes( x = continent, y = lifeExp )
    ) +
  geom_boxplot(fill = "skyblue", color = "blue4") +
  labs(
    title = "Expectativa de vida por continente en el año 2007",
    x = "Continente", y = "Esperanza de vida al nacer (años)") +
  theme_minimal()


lifeExp_2007_grafico_boxplot

# lifeExp_2007_grafico_boxplot <- ggplotly(lifeExp_2007_grafico_boxplot)
# 
# lifeExp_2007_grafico_boxplot

```


# Tabla interactiva 
```{r}
# {.tabset .tabset-pills}
```

Tabla de resumen filtrando los datos para el año 2007.

```{r}
library(kableExtra)

# get data
data_table <- gapminder %>%
  filter(year == 2007) %>%
  group_by(continent) %>%
  summarise("Media Esperanza Vida" = round(mean(lifeExp), 2), 
    "Media PIB Percapita" = round(mean(gdpPercap), 2),
    "Media poblacion" = round(mean(pop), 2),
  )
# create table
table_personalized <- data_table %>%
  # kableExtra options
  kbl(caption = "Resumen de Datos de Gapminder") %>%
  kable_styling(
    bootstrap_options = c(
      #"hover", 
      "condensed", 
      "striped"
      ), 
    full_width = F, 
    font_size = 14,
    # font_color = "gray2"
    # position = "l"
    ) %>%
  row_spec(0, color = "black", bold = T)

# pdf
table_personalized
# names(gapminder)

library(flextable)
flextable(data_table)

```

```{r}
# <hr>
# <div style="text-align: center;">
# <p><strong>Construcción de informes en R</strong> <br>
# <strong>Desarrollado por: Crispthofer Rincon</strong> <br>
# <strong>2023.</strong></p>
# </div>

```

